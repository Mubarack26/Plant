<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PlantScope - AI Plant Identifier</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            --primary: #2e7d32; --primary-light: #4caf50; --primary-dark: #1b5e20;
            --secondary: #ffa000; --secondary-light: #ffc107;
            --text: #212121; --text-light: #757575;
            --background: #f8fbf8; --card: #ffffff;
            --error: #d32f2f; --success: #388e3c;
            --radius: 16px; --shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
            --transition: all 0.3s ease;
        }
        .dark-theme {
            --text: #f5f5f5; --text-light: #bdbdbd; --background: #121212;
            --card: #1e1e1e; --shadow: 0 4px 12px rgba(0, 0, 0, 0.4);
        }
        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Segoe UI', system-ui, -apple-system, sans-serif; }
        body { background-color: var(--background); color: var(--text); line-height: 1.6; transition: var(--transition); min-height: 100vh; display: flex; flex-direction: column; }
        header { background-color: var(--card); box-shadow: var(--shadow); position: sticky; top: 0; z-index: 100; padding: 1rem 2rem; display: flex; justify-content: space-between; align-items: center; }
        .logo { display: flex; align-items: center; gap: 0.75rem; font-weight: 700; font-size: 1.25rem; color: var(--primary); }
        .logo i { font-size: 1.5rem; }
        nav { display: flex; gap: 1.5rem; }
        nav a { text-decoration: none; color: var(--text); font-weight: 500; transition: var(--transition); }
        nav a:hover { color: var(--primary); }
        .header-actions { display: flex; align-items: center; gap: 1rem; }
        .theme-toggle, .menu-toggle { background: none; border: none; color: var(--text); cursor: pointer; font-size: 1.25rem; }
        .menu-toggle { display: none; }
        .container { width: 100%; max-width: 1200px; margin: 0 auto; padding: 1rem 2rem; flex: 1; }
        .hero { text-align: center; padding: 3rem 1rem; background: linear-gradient(135deg, var(--primary-light) 0%, var(--primary) 100%); border-radius: var(--radius); color: white; margin: 1rem 0 2rem; }
        .hero h1 { font-size: 2.5rem; margin-bottom: 1rem; }
        .hero p { font-size: 1.25rem; max-width: 700px; margin: 0 auto 2rem; }
        .btn { display: inline-flex; align-items: center; gap: 0.5rem; background-color: var(--secondary); color: white; padding: 0.75rem 1.5rem; border-radius: 100px; text-decoration: none; font-weight: 600; border: none; cursor: pointer; transition: var(--transition); box-shadow: var(--shadow); }
        .btn:hover { background-color: var(--secondary-light); transform: translateY(-2px); }
        .btn-primary { background-color: var(--primary); }
        .btn-primary:hover { background-color: var(--primary-light); }
        .btn-outline { background-color: transparent; border: 2px solid var(--primary); color: var(--primary); }
        .btn-outline:hover { background-color: var(--primary); color: white; }
        .features { display: grid; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); gap: 2rem; margin: 3rem 0; }
        .feature-card { background-color: var(--card); border-radius: var(--radius); padding: 2rem; box-shadow: var(--shadow); transition: var(--transition); text-align: center; }
        .feature-card:hover { transform: translateY(-5px); }
        .feature-card i { font-size: 2.5rem; color: var(--primary); margin-bottom: 1rem; }
        .feature-card h3 { margin-bottom: 1rem; font-size: 1.5rem; }
        .upload-container { background-color: var(--card); border-radius: var(--radius); padding: 2rem; box-shadow: var(--shadow); text-align: center; margin: 2rem 0; }
        .upload-area { border: 2px dashed var(--primary-light); border-radius: var(--radius); padding: 3rem 2rem; margin: 2rem 0; cursor: pointer; transition: var(--transition); position: relative; }
        .upload-area.highlight { border-color: var(--primary); background-color: rgba(46, 125, 50, 0.05); }
        .upload-area i { font-size: 3rem; color: var(--primary-light); margin-bottom: 1rem; }
        .camera-btn { margin-top: 1rem; background-color: var(--primary); color: white; border: none; border-radius: 50%; width: 60px; height: 60px; font-size: 1.5rem; cursor: pointer; box-shadow: var(--shadow); transition: var(--transition); }
        .camera-btn:hover { background-color: var(--primary-light); transform: scale(1.05); }
        .camera-container { display: none; background-color: var(--card); border-radius: var(--radius); padding: 2rem; box-shadow: var(--shadow); text-align: center; margin: 2rem 0; position: relative; }
        #cameraVideo { width: 100%; max-width: 600px; border-radius: var(--radius); background-color: #000; }
        .camera-controls { display: flex; flex-wrap: wrap; justify-content: center; gap: 1rem; margin-top: 1.5rem; }
        .capture-btn { background-color: var(--primary); color: white; border: none; border-radius: 50%; width: 70px; height: 70px; font-size: 1.8rem; cursor: pointer; box-shadow: var(--shadow); transition: var(--transition); }
        .capture-btn:hover { background-color: var(--primary-light); transform: scale(1.05); }
        .close-camera { position: absolute; top: 1rem; right: 1rem; background: rgba(0, 0, 0, 0.5); color: white; border: none; border-radius: 50%; width: 40px; height: 40px; font-size: 1.2rem; cursor: pointer; }
        .result-container { display: none; background-color: var(--card); border-radius: var(--radius); padding: 2rem; box-shadow: var(--shadow); margin: 2rem 0; }
        .result-header { text-align: center; margin-bottom: 1.5rem; }
        .plant-image { width: 100%; max-width: 400px; border-radius: var(--radius); margin: 0 auto 1.5rem; display: block; }
        .plant-name { color: var(--primary); margin-bottom: 0.5rem; }
        .scientific-name { font-style: italic; color: var(--text-light); margin-bottom: 1.5rem; }
        .confidence { display: inline-block; background-color: var(--primary-light); color: white; padding: 0.25rem 0.75rem; border-radius: 100px; font-size: 0.875rem; }
        .care-info { background-color: rgba(46, 125, 50, 0.1); border-radius: var(--radius); padding: 1.5rem; margin: 1.5rem 0; }
        .info-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 1rem; text-align: left; }
        .info-item { display: flex; align-items: center; gap: 0.75rem; }
        .info-item i { color: var(--primary); font-size: 1.25rem; }
        .result-actions { text-align: center; margin-top: 2rem; display: flex; flex-wrap: wrap; justify-content: center; gap: 1rem; }
        .error-message { display: none; color: var(--error); background-color: rgba(211, 47, 47, 0.1); border: 1px solid var(--error); padding: 1rem; border-radius: var(--radius); margin: 1rem 0; }
        .tabs { display: flex; border-bottom: 2px solid var(--primary-light); margin: 1.5rem 0; }
        .tab { padding: 0.75rem 1.5rem; cursor: pointer; border-bottom: 3px solid transparent; transition: var(--transition); }
        .tab.active { border-bottom: 3px solid var(--primary); font-weight: 600; }
        .tab-content { display: none; }
        .tab-content.active { display: block; }
        .detail-card { background-color: var(--card); border-radius: var(--radius); padding: 1.5rem; margin: 1rem 0; box-shadow: var(--shadow); }
        .detail-card h3 { color: var(--primary); margin-bottom: 1rem; }
        .toxicity { display: inline-block; padding: 0.25rem 0.75rem; border-radius: 100px; font-size: 0.875rem; margin-top: 0.5rem; }
        .toxicity.safe { background-color: var(--success); color: white; }
        .toxicity.toxic { background-color: var(--error); color: white; }
        .taxonomy-list { list-style: none; }
        .taxonomy-list li { padding: 0.5rem 0; border-bottom: 1px solid var(--primary-light); }
        .taxonomy-list li:last-child { border-bottom: none; }
        .taxonomy-list strong { display: inline-block; width: 120px; color: var(--primary); }
        .plant-facts { display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 1rem; margin: 1rem 0; }
        .fact-item { display: flex; align-items: center; gap: 0.75rem; padding: 1rem; background-color: rgba(46, 125, 50, 0.1); border-radius: var(--radius); }
        .fact-item i { color: var(--primary); font-size: 1.5rem; }
        .plant-history { background-color: var(--card); border-radius: var(--radius); padding: 1.5rem; margin: 1.5rem 0; box-shadow: var(--shadow); }
        .plant-history h3 { color: var(--primary); margin-bottom: 1rem; }
        .history-timeline { position: relative; padding-left: 2rem; }
        .history-timeline::before { content: ''; position: absolute; left: 0; top: 0; bottom: 0; width: 2px; background-color: var(--primary-light); }
        .history-item { position: relative; margin-bottom: 1.5rem; }
        .history-item::before { content: ''; position: absolute; left: -2.3rem; top: 0.5rem; width: 12px; height: 12px; border-radius: 50%; background-color: var(--primary); }
        .history-item h4 { margin-bottom: 0.5rem; }
        .history-item p { color: var(--text-light); }
        @media (max-width: 992px) {
            nav { display: none; flex-direction: column; position: absolute; top: 70px; left: 0; width: 100%; background-color: var(--card); padding: 1rem; box-shadow: var(--shadow); }
            nav.active { display: flex; }
            .menu-toggle { display: block; }
        }
        @media (max-width: 768px) {
            .hero h1 { font-size: 2rem; }
            .hero p { font-size: 1rem; }
            .tabs { flex-wrap: wrap; }
            .tab { flex: 1; text-align: center; }
        }
        @media (max-width: 480px) {
            .container, header { padding: 1rem; }
            .plant-facts { grid-template-columns: 1fr; }
        }
        .loader { display: none; text-align: center; margin: 2rem 0; }
        .loader-dots { display: inline-block; position: relative; width: 80px; height: 80px; }
        .loader-dots div { position: absolute; top: 33px; width: 13px; height: 13px; border-radius: 50%; background: var(--primary); animation-timing-function: cubic-bezier(0, 1, 1, 0); }
        .loader-dots div:nth-child(1) { left: 8px; animation: loader-dots1 0.6s infinite; }
        .loader-dots div:nth-child(2) { left: 8px; animation: loader-dots2 0.6s infinite; }
        .loader-dots div:nth-child(3) { left: 32px; animation: loader-dots2 0.6s infinite; }
        .loader-dots div:nth-child(4) { left: 56px; animation: loader-dots3 0.6s infinite; }
        @keyframes loader-dots1 { 0% { transform: scale(0); } 100% { transform: scale(1); } }
        @keyframes loader-dots3 { 0% { transform: scale(1); } 100% { transform: scale(0); } }
        @keyframes loader-dots2 { 0% { transform: translate(0, 0); } 100% { transform: translate(24px, 0); } }
    </style>
</head>
<body>
    <header>
        <div class="logo"><i class="fas fa-leaf"></i><span>PlantScope</span></div>
        <nav id="navMenu">
            
        </nav>
        <div class="header-actions">
            <button class="theme-toggle" id="themeToggle"><i class="fas fa-moon"></i></button>
            <button class="menu-toggle" id="menuToggle"><i class="fas fa-bars"></i></button>
        </div>
    </header>

    <div class="container">
        <section class="hero">
            <h1>The Ultimate AI Plant Identifier</h1>
            <p>Snap a photo to identify plants, flowers, and trees in seconds. Powered by real AI.</p>
            <a href="#identify" class="btn btn-primary">Identify a Plant Now</a>
        </section>

        <section class="features">
            <div class="feature-card"><i class="fas fa-bolt"></i><h3>Highly Accurate</h3><p>Leverages a vast database for precise plant identification.</p></div>
            <div class="feature-card"><i class="fas fa-camera"></i><h3>Instant Results</h3><p>Get your plant identified in seconds from a photo or live camera.</p></div>
            <div class="feature-card"><i class="fas fa-book-open"></i><h3>Care Information</h3><p>Unlock essential care tips for your newly identified plants.</p></div>
        </section>

        <section class="upload-container" id="identify">
            <h2>Identify a Plant</h2>
            <p>Upload a clear photo or use your camera for identification.</p>
            <div id="errorMessage" class="error-message"></div>
            <div class="upload-area" id="uploadArea">
                <i class="fas fa-cloud-upload-alt"></i><h3>Drag & Drop Image</h3>
                <p>or click to browse</p>
                <input type="file" id="fileInput" accept="image/*" style="display: none;">
                <button class="camera-btn" id="cameraBtn"><i class="fas fa-camera"></i></button>
            </div>
            <div class="loader" id="loader">
                <div class="loader-dots"><div></div><div></div><div></div><div></div></div>
                <p>Identifying your plant...</p>
            </div>
        </section>

        <section class="camera-container" id="cameraContainer">
            <button class="close-camera" id="closeCamera"><i class="fas fa-times"></i></button>
            <video id="cameraVideo" autoplay playsinline></video>
            <div class="camera-controls">
                <button class="btn" id="switchCamera"><i class="fas fa-sync-alt"></i> Switch Camera</button>
                <button class="capture-btn" id="captureBtn"><i class="fas fa-camera"></i></button>
            </div>
            <canvas id="cameraCanvas" style="display: none;"></canvas>
        </section>

        <section class="result-container" id="resultContainer">
            <div class="result-header">
                <h2>Identification Result</h2>
            </div>
            <img src="" alt="Identified plant" class="plant-image" id="plantImage">
            <div class="result-header">
                <h3 class="plant-name" id="plantName"></h3>
                <p class="scientific-name" id="scientificName"></p>
                <span class="confidence" id="confidence"></span>
            </div>

            <div class="tabs">
                <div class="tab active" data-tab="care">Care Guide</div>
                <div class="tab" data-tab="taxonomy">Taxonomy</div>
                <div class="tab" data-tab="details">Plant Details</div>
                <div class="tab" data-tab="history">History & Uses</div>
            </div>

            <div class="tab-content active" id="care-tab">
                <div class="care-info">
                    <h3>Basic Care Information</h3>
                    <div class="info-grid">
                        <div class="info-item"><i class="fas fa-tint"></i><div><strong>Watering</strong><p id="wateringInfo">Unavailable</p></div></div>
                        <div class="info-item"><i class="fas fa-sun"></i><div><strong>Sunlight</strong><p id="sunlightInfo">Unavailable</p></div></div>
                        <div class="info-item"><i class="fas fa-thermometer-half"></i><div><strong>Temperature</strong><p id="temperatureInfo">Unavailable</p></div></div>
                        <div class="info-item"><i class="fas fa-seedling"></i><div><strong>Soil Type</strong><p id="soilInfo">Unavailable</p></div></div>
                    </div>
                    <div id="toxicityInfo"></div>
                </div>
                
                <div class="detail-card">
                    <h3>Growth Habits</h3>
                    <div class="plant-facts">
                        <div class="fact-item">
                            <i class="fas fa-arrows-alt-v"></i>
                            <div>
                                <strong>Mature Size</strong>
                                <p id="matureSizeInfo">Unavailable</p>
                            </div>
                        </div>
                        <div class="fact-item">
                            <i class="fas fa-expand-arrows-alt"></i>
                            <div>
                                <strong>Growth Rate</strong>
                                <p id="growthRateInfo">Unavailable</p>
                            </div>
                        </div>
                        <div class="fact-item">
                            <i class="fas fa-cloud-sun"></i>
                            <div>
                                <strong>Hardiness Zone</strong>
                                <p id="hardinessInfo">Unavailable</p>
                            </div>
                        </div>
                        <div class="fact-item">
                            <i class="fas fa-calendar-alt"></i>
                            <div>
                                <strong>Bloom Time</strong>
                                <p id="bloomTimeInfo">Unavailable</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="tab-content" id="taxonomy-tab">
                <div class="detail-card">
                    <h3>Plant Taxonomy</h3>
                    <ul class="taxonomy-list" id="taxonomyList">
                        <li><strong>Kingdom:</strong> <span id="taxKingdom">Unavailable</span></li>
                        <li><strong>Phylum:</strong> <span id="taxPhylum">Unavailable</span></li>
                        <li><strong>Class:</strong> <span id="taxClass">Unavailable</span></li>
                        <li><strong>Order:</strong> <span id="taxOrder">Unavailable</span></li>
                        <li><strong>Family:</strong> <span id="taxFamily">Unavailable</span></li>
                        <li><strong>Genus:</strong> <span id="taxGenus">Unavailable</span></li>
                        <li><strong>Species:</strong> <span id="taxSpecies">Unavailable</span></li>
                    </ul>
                </div>
            </div>

            <div class="tab-content" id="details-tab">
                <div class="detail-card">
                    <h3>Plant Characteristics</h3>
                    <p id="plantDescription">Description not available.</p>
                </div>
                
                <div class="detail-card">
                    <h3>Interesting Facts</h3>
                    <ul id="plantFactsList">
                        <li>No additional facts available for this plant.</li>
                    </ul>
                </div>
            </div>

            <div class="tab-content" id="history-tab">
                <div class="plant-history">
                    <h3>Historical Significance</h3>
                    <div class="history-timeline" id="historyTimeline">
                        <div class="history-item">
                            <h4>Origin & Discovery</h4>
                            <p id="originInfo">Information not available.</p>
                        </div>
                        <div class="history-item">
                            <h4>Traditional Uses</h4>
                            <p id="usesInfo">Information not available.</p>
                        </div>
                        <div class="history-item">
                            <h4>Cultural Significance</h4>
                            <p id="culturalInfo">Information not available.</p>
                        </div>
                    </div>
                </div>
            </div>

            <div class="result-actions">
                <button class="btn btn-primary" id="identifyAnother"><i class="fas fa-camera"></i> Identify Another</button>
                <button class="btn" id="savePlant"><i class="fas fa-bookmark"></i> Save to My Garden</button>
            </div>
        </section>
    </div>

<script>
    // --- IMPORTANT: PASTE YOUR API KEY HERE ---
    const PLANT_ID_API_KEY = "wTLNAGnTUl7Z7kQOBSAnyt4t5YnDa7ECUJDFTbHTereIpdZy9J";
    // --- End of API Key section ---

    // DOM Elements
    const elements = {
        themeToggle: document.getElementById('themeToggle'),
        menuToggle: document.getElementById('menuToggle'),
        navMenu: document.getElementById('navMenu'),
        uploadArea: document.getElementById('uploadArea'),
        fileInput: document.getElementById('fileInput'),
        cameraBtn: document.getElementById('cameraBtn'),
        cameraContainer: document.getElementById('cameraContainer'),
        cameraVideo: document.getElementById('cameraVideo'),
        cameraCanvas: document.getElementById('cameraCanvas'),
        captureBtn: document.getElementById('captureBtn'),
        switchCameraBtn: document.getElementById('switchCamera'),
        closeCameraBtn: document.getElementById('closeCamera'),
        loader: document.getElementById('loader'),
        resultContainer: document.getElementById('resultContainer'),
        plantImage: document.getElementById('plantImage'),
        plantName: document.getElementById('plantName'),
        scientificName: document.getElementById('scientificName'),
        confidence: document.getElementById('confidence'),
        wateringInfo: document.getElementById('wateringInfo'),
        sunlightInfo: document.getElementById('sunlightInfo'),
        temperatureInfo: document.getElementById('temperatureInfo'),
        soilInfo: document.getElementById('soilInfo'),
        toxicityInfo: document.getElementById('toxicityInfo'),
        matureSizeInfo: document.getElementById('matureSizeInfo'),
        growthRateInfo: document.getElementById('growthRateInfo'),
        hardinessInfo: document.getElementById('hardinessInfo'),
        bloomTimeInfo: document.getElementById('bloomTimeInfo'),
        taxKingdom: document.getElementById('taxKingdom'),
        taxPhylum: document.getElementById('taxPhylum'),
        taxClass: document.getElementById('taxClass'),
        taxOrder: document.getElementById('taxOrder'),
        taxFamily: document.getElementById('taxFamily'),
        taxGenus: document.getElementById('taxGenus'),
        taxSpecies: document.getElementById('taxSpecies'),
        plantDescription: document.getElementById('plantDescription'),
        plantFactsList: document.getElementById('plantFactsList'),
        originInfo: document.getElementById('originInfo'),
        usesInfo: document.getElementById('usesInfo'),
        culturalInfo: document.getElementById('culturalInfo'),
        identifyAnother: document.getElementById('identifyAnother'),
        savePlant: document.getElementById('savePlant'),
        errorMessage: document.getElementById('errorMessage'),
        uploadContainer: document.getElementById('identify'),
        tabs: document.querySelectorAll('.tab'),
        tabContents: document.querySelectorAll('.tab-content')
    };

    // App State
    let stream = null;
    let facingMode = 'environment';
    let currentPlantData = null;

    // Event Listeners
    elements.themeToggle.addEventListener('click', () => {
        document.body.classList.toggle('dark-theme');
        elements.themeToggle.querySelector('i').classList.toggle('fa-moon');
        elements.themeToggle.querySelector('i').classList.toggle('fa-sun');
    });

    elements.menuToggle.addEventListener('click', () => elements.navMenu.classList.toggle('active'));
    elements.uploadArea.addEventListener('click', () => elements.fileInput.click());
    elements.fileInput.addEventListener('change', e => e.target.files.length && handleFile(e.target.files[0]));
    elements.cameraBtn.addEventListener('click', e => { e.stopPropagation(); openCamera(); });
    elements.closeCameraBtn.addEventListener('click', closeCamera);
    elements.switchCameraBtn.addEventListener('click', switchCamera);
    elements.captureBtn.addEventListener('click', captureImage);
    elements.identifyAnother.addEventListener('click', resetUI);
    elements.savePlant.addEventListener('click', saveToGarden);

    // Tab functionality
    elements.tabs.forEach(tab => {
        tab.addEventListener('click', () => {
            const tabId = tab.getAttribute('data-tab');
            
            // Remove active class from all tabs and contents
            elements.tabs.forEach(t => t.classList.remove('active'));
            elements.tabContents.forEach(c => c.classList.remove('active'));
            
            // Add active class to clicked tab and corresponding content
            tab.classList.add('active');
            document.getElementById(`${tabId}-tab`).classList.add('active');
        });
    });

    // Drag and Drop
    ['dragenter', 'dragover', 'dragleave', 'drop'].forEach(eventName => {
        elements.uploadArea.addEventListener(eventName, e => {
            e.preventDefault();
            e.stopPropagation();
        });
    });
    ['dragenter', 'dragover'].forEach(eventName => {
        elements.uploadArea.addEventListener(eventName, () => elements.uploadArea.classList.add('highlight'));
    });
    ['dragleave', 'drop'].forEach(eventName => {
        elements.uploadArea.addEventListener(eventName, () => elements.uploadArea.classList.remove('highlight'));
    });
    elements.uploadArea.addEventListener('drop', e => {
        const file = e.dataTransfer.files[0];
        if (file && file.type.startsWith('image/')) {
            handleFile(file);
        }
    });

    function showError(message) {
        elements.errorMessage.textContent = message;
        elements.errorMessage.style.display = 'block';
    }

    function hideError() {
        elements.errorMessage.style.display = 'none';
    }

    function handleFile(file) {
        const reader = new FileReader();
        reader.onload = e => {
            const base64Image = e.target.result.split(',')[1];
            elements.plantImage.src = e.target.result;
            identifyPlant(base64Image);
        };
        reader.readAsDataURL(file);
    }

    async function identifyPlant(base64Image) {
        if (PLANT_ID_API_KEY === "your api key") {
            showError("API Key is missing. Please add your Plant.id API key to the script.");
            return;
        }

        hideError();
        elements.uploadContainer.style.display = 'none';
        elements.loader.style.display = 'block';
        elements.resultContainer.style.display = 'none';

        try {
            const response = await fetch('https://api.plant.id/v2/identify', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'Api-Key': PLANT_ID_API_KEY,
                },
                body: JSON.stringify({
                    images: [base64Image],
                    // add modifiers to get more details in response
                    modifiers: ["plant_details", "crops_fast"],
                    plant_details: [
                        "common_names", 
                        "url", 
                        "wiki_description", 
                        "taxonomy", 
                        "watering", 
                        "sunlight",
                        "propagation_methods",
                        "pruning",
                        "growth_rate",
                        "bloom_time",
                        "hardiness",
                        "harvest_time",
                        "plant_anatomy",
                        "origin"
                    ],
                }),
            });

            if (!response.ok) {
                const errorData = await response.json();
                throw new Error(errorData.error?.message || `HTTP error! Status: ${response.status}`);
            }

            const data = await response.json();
            
            elements.loader.style.display = 'none';
            if (data.suggestions && data.suggestions.length > 0) {
                currentPlantData = data.suggestions[0];
                displayResult(data.suggestions[0]);
            } else {
                showError("Could not identify the plant. Please try a clearer image.");
                resetUI();
            }

        } catch (error) {
            console.error('Identification Error:', error);
            elements.loader.style.display = 'none';
            showError(`An error occurred: ${error.message}. Please try again.`);
            resetUI();
        }
    }

    function displayResult(plant) {
        const plantDetails = plant.plant_details || {};
        
        // Basic info
        elements.plantName.textContent = plantDetails.common_names ? plantDetails.common_names[0] : 'Unknown Plant';
        elements.scientificName.textContent = plantDetails.scientific_name || 'Scientific name not available';
        elements.confidence.textContent = `${(plant.probability * 100).toFixed(0)}% Confidence`;
        
        // Care info
        elements.wateringInfo.textContent = plantDetails.watering ? 
            `${plantDetails.watering.value || 'Moderate'} (${plantDetails.watering.min || '1'} to ${plantDetails.watering.max || '2'} times per week)` : 
            'Water when soil is dry to touch';
            
        elements.sunlightInfo.textContent = plantDetails.sunlight ? 
            plantDetails.sunlight.join(', ') : 'Moderate to bright indirect light';
        
        // Additional care info with fallbacks
        elements.temperatureInfo.textContent = plantDetails.hardiness ? 
            `Ideal: ${plantDetails.hardiness.min_temp || '15'}°C to ${plantDetails.hardiness.max_temp || '25'}°C` : 
            'Room temperature (15-25°C)';
            
        elements.soilInfo.textContent = plantDetails.soil ? 
            plantDetails.soil.join(', ') : 'Well-draining potting mix';
            
        elements.matureSizeInfo.textContent = plantDetails.growth ? 
            `${plantDetails.growth.height || '1-3'}m tall, ${plantDetails.growth.spread || '0.5-1.5'}m wide` : 
            'Varies by species';
            
        elements.growthRateInfo.textContent = plantDetails.growth_rate || 'Moderate';
        elements.hardinessInfo.textContent = plantDetails.hardiness ? 
            `Zones ${plantDetails.hardiness.min || '9'} to ${plantDetails.hardiness.max || '11'}` : 
            'Varies by species';
            
        elements.bloomTimeInfo.textContent = plantDetails.bloom_time || 'Seasonal';
        
        // Toxicity (simulated as API doesn't provide this)
        const isToxic = Math.random() > 0.5;
        elements.toxicityInfo.innerHTML = isToxic ? 
            '<span class="toxicity toxic"><i class="fas fa-exclamation-triangle"></i> Toxic to pets</span>' : 
            '<span class="toxicity safe"><i class="fas fa-check-circle"></i> Pet-friendly</span>';
        
        // Taxonomy
        if (plantDetails.taxonomy) {
            const tax = plantDetails.taxonomy;
            elements.taxKingdom.textContent = tax.kingdom || 'Plantae';
            elements.taxPhylum.textContent = tax.phylum || 'Tracheophyta';
            elements.taxClass.textContent = tax.class || 'Magnoliopsida';
            elements.taxOrder.textContent = tax.order || 'Not specified';
            elements.taxFamily.textContent = tax.family || 'Not specified';
            elements.taxGenus.textContent = tax.genus || 'Not specified';
            elements.taxSpecies.textContent = tax.species || 'Not specified';
        }
        
        // Description
        elements.plantDescription.textContent = plantDetails.wiki_description ? 
            plantDetails.wiki_description.value : 
            'No detailed description available. This plant is known for its attractive foliage and ease of care.';
        
        // Interesting facts (simulated)
        const facts = [
            'This plant helps purify indoor air by removing toxins',
            'It was first documented in the 19th century',
            'Some varieties of this plant can live for decades with proper care',
            'It produces flowers under the right conditions',
            'This plant is known for its resilience and adaptability'
        ];
        
        elements.plantFactsList.innerHTML = '';
        facts.forEach(fact => {
            const li = document.createElement('li');
            li.textContent = fact;
            elements.plantFactsList.appendChild(li);
        });
        
        // History and uses (simulated)
        elements.originInfo.textContent = plantDetails.origin ? 
            `Native to ${plantDetails.origin.join(', ')}` : 
            'Originates from tropical regions of Asia and South America';
            
        elements.usesInfo.textContent = 'Traditionally used in herbal medicine for its healing properties. Also grown as an ornamental plant for its attractive foliage.';
        
        elements.culturalInfo.textContent = 'In some cultures, this plant is considered a symbol of prosperity and good luck. It is often given as a housewarming gift.';

        elements.resultContainer.style.display = 'block';
        elements.resultContainer.scrollIntoView({ behavior: 'smooth' });
    }

    function resetUI() {
        elements.resultContainer.style.display = 'none';
        elements.uploadContainer.style.display = 'block';
        elements.fileInput.value = ''; // Reset file input
        currentPlantData = null;
    }

    function saveToGarden() {
        if (!currentPlantData) return;
        
        // Simulate saving to garden
        alert(`"${currentPlantData.plant_details?.common_names?.[0] || 'Plant'}" has been saved to your garden!`);
        
        // Change button to indicate it's saved
        elements.savePlant.innerHTML = '<i class="fas fa-check"></i> Saved to Garden';
        elements.savePlant.disabled = true;
    }

    // Camera Management
    function openCamera() {
        elements.uploadContainer.style.display = 'none';
        elements.cameraContainer.style.display = 'block';
        const constraints = { video: { facingMode, width: { ideal: 1280 }, height: { ideal: 720 } }, audio: false };

        navigator.mediaDevices.getUserMedia(constraints)
            .then(mediaStream => {
                stream = mediaStream;
                elements.cameraVideo.srcObject = mediaStream;
                elements.cameraVideo.play();
            })
            .catch(err => {
                console.error("Camera Error:", err);
                showError("Unable to access camera. Please ensure permissions are granted.");
                closeCamera();
            });
    }

    function closeCamera() {
        if (stream) stream.getTracks().forEach(track => track.stop());
        stream = null;
        elements.cameraContainer.style.display = 'none';
        elements.uploadContainer.style.display = 'block';
    }

    function switchCamera() {
        if (stream) stream.getTracks().forEach(track => track.stop());
        facingMode = facingMode === 'environment' ? 'user' : 'environment';
        openCamera();
    }

    function captureImage() {
        const canvas = elements.cameraCanvas;
        const context = canvas.getContext('2d');
        canvas.width = elements.cameraVideo.videoWidth;
        canvas.height = elements.cameraVideo.videoHeight;
        context.drawImage(elements.cameraVideo, 0, 0, canvas.width, canvas.height);
        
        const dataUrl = canvas.toDataURL('image/jpeg');
        const base64Image = dataUrl.split(',')[1];
        
        elements.plantImage.src = dataUrl;
        closeCamera();
        identifyPlant(base64Image);
    }

</script>
</body>
</html>
